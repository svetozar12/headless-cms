[{"E:\\coding_journey\\headless-cms\\packages\\server\\jest.config.ts":"1","E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\errorModel.ts":"2","E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\schema.ts":"3","E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\types.d.ts":"4","E:\\coding_journey\\headless-cms\\packages\\server\\src\\env\\schema.ts":"5","E:\\coding_journey\\headless-cms\\packages\\server\\src\\env\\server.ts":"6","E:\\coding_journey\\headless-cms\\packages\\server\\src\\index.ts":"7","E:\\coding_journey\\headless-cms\\packages\\server\\src\\middlewares\\errorHandler.ts":"8","E:\\coding_journey\\headless-cms\\packages\\server\\src\\middlewares\\isAuth.ts":"9","E:\\coding_journey\\headless-cms\\packages\\server\\src\\preinit.ts":"10","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\auth.ts":"11","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\index.ts":"12","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\schema.ts":"13","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\utils.ts":"14","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\content.schema.ts":"15","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\content.ts":"16","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\index.ts":"17","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\contentModel.schema.ts":"18","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\contentModel.ts":"19","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\index.ts":"20","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\health\\health.ts":"21","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\health\\index.ts":"22","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\index.ts":"23","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\index.ts":"24","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\schema.ts":"25","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\user.ts":"26","E:\\coding_journey\\headless-cms\\packages\\server\\src\\types\\express\\index.d.ts":"27","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\logger.ts":"28","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\content.ts":"29","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\contentModel.ts":"30","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\preMiddleware.ts":"31","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\user.ts":"32","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\prisma.ts":"33","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\zParse.ts":"34","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\auth\\auth.test.ts":"35","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\contentModel\\contentModel.test.ts":"36","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\jest.setup.ts":"37","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\user\\user.test.ts":"38","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\utils.ts":"39"},{"size":163,"mtime":1667519154915,"results":"40","hashOfConfig":"41"},{"size":1497,"mtime":1666558624661,"results":"42","hashOfConfig":"41"},{"size":386,"mtime":1667852041397,"results":"43","hashOfConfig":"41"},{"size":59,"mtime":1666455508174,"results":"44","hashOfConfig":"41"},{"size":342,"mtime":1666563792909,"results":"45","hashOfConfig":"41"},{"size":609,"mtime":1667757769320,"results":"46","hashOfConfig":"41"},{"size":643,"mtime":1667757359784,"results":"47","hashOfConfig":"41"},{"size":966,"mtime":1666558657961,"results":"48","hashOfConfig":"41"},{"size":747,"mtime":1666650785404,"results":"49","hashOfConfig":"41"},{"size":171,"mtime":1667757289087,"results":"50","hashOfConfig":"41"},{"size":2000,"mtime":1667572507553,"results":"51","hashOfConfig":"41"},{"size":34,"mtime":1666119078844,"results":"52","hashOfConfig":"41"},{"size":631,"mtime":1666204894243,"results":"53","hashOfConfig":"41"},{"size":1274,"mtime":1667757320970,"results":"54","hashOfConfig":"41"},{"size":362,"mtime":1667770698924,"results":"55","hashOfConfig":"41"},{"size":2410,"mtime":1667604333779,"results":"56","hashOfConfig":"41"},{"size":37,"mtime":1667757289087,"results":"57","hashOfConfig":"41"},{"size":340,"mtime":1667770651303,"results":"58","hashOfConfig":"41"},{"size":2021,"mtime":1667854404000,"results":"59","hashOfConfig":"41"},{"size":42,"mtime":1666293878278,"results":"60","hashOfConfig":"41"},{"size":246,"mtime":1666121797790,"results":"61","hashOfConfig":"41"},{"size":36,"mtime":1667757289087,"results":"62","hashOfConfig":"41"},{"size":606,"mtime":1667760918193,"results":"63","hashOfConfig":"41"},{"size":34,"mtime":1666186911115,"results":"64","hashOfConfig":"41"},{"size":161,"mtime":1666196637960,"results":"65","hashOfConfig":"41"},{"size":1802,"mtime":1667604326658,"results":"66","hashOfConfig":"41"},{"size":435,"mtime":1667574097172,"results":"67","hashOfConfig":"41"},{"size":259,"mtime":1667769227147,"results":"68","hashOfConfig":"41"},{"size":512,"mtime":1667755982431,"results":"69","hashOfConfig":"41"},{"size":592,"mtime":1667604109863,"results":"70","hashOfConfig":"41"},{"size":1054,"mtime":1667573445597,"results":"71","hashOfConfig":"41"},{"size":595,"mtime":1667771675992,"results":"72","hashOfConfig":"41"},{"size":488,"mtime":1667345481804,"results":"73","hashOfConfig":"41"},{"size":1084,"mtime":1666651589539,"results":"74","hashOfConfig":"41"},{"size":3806,"mtime":1667757289087,"results":"75","hashOfConfig":"41"},{"size":6862,"mtime":1667854479808,"results":"76","hashOfConfig":"41"},{"size":72,"mtime":1666640865847,"results":"77","hashOfConfig":"41"},{"size":3080,"mtime":1667756993484,"results":"78","hashOfConfig":"41"},{"size":553,"mtime":1667771090147,"results":"79","hashOfConfig":"41"},{"filePath":"80","messages":"81","suppressedMessages":"82","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"1udcod2",{"filePath":"83","messages":"84","suppressedMessages":"85","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"86","messages":"87","suppressedMessages":"88","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"89","messages":"90","suppressedMessages":"91","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"92","messages":"93","suppressedMessages":"94","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"95","messages":"96","suppressedMessages":"97","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"98"},{"filePath":"99","messages":"100","suppressedMessages":"101","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"102","messages":"103","suppressedMessages":"104","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"105"},{"filePath":"106","messages":"107","suppressedMessages":"108","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"109","messages":"110","suppressedMessages":"111","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"112"},{"filePath":"113","messages":"114","suppressedMessages":"115","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"116","messages":"117","suppressedMessages":"118","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"119","messages":"120","suppressedMessages":"121","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"122","messages":"123","suppressedMessages":"124","errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"125"},{"filePath":"126","messages":"127","suppressedMessages":"128","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"129","messages":"130","suppressedMessages":"131","errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"132"},{"filePath":"133","messages":"134","suppressedMessages":"135","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"136","messages":"137","suppressedMessages":"138","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"139"},{"filePath":"140","messages":"141","suppressedMessages":"142","errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"143"},{"filePath":"144","messages":"145","suppressedMessages":"146","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"147","messages":"148","suppressedMessages":"149","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"150"},{"filePath":"151","messages":"152","suppressedMessages":"153","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"154","messages":"155","suppressedMessages":"156","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"157","messages":"158","suppressedMessages":"159","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"160","messages":"161","suppressedMessages":"162","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"163","messages":"164","suppressedMessages":"165","errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"166"},{"filePath":"167","messages":"168","suppressedMessages":"169","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"170","messages":"171","suppressedMessages":"172","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"173","messages":"174","suppressedMessages":"175","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"176"},{"filePath":"177","messages":"178","suppressedMessages":"179","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"180"},{"filePath":"181","messages":"182","suppressedMessages":"183","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"184"},{"filePath":"185","messages":"186","suppressedMessages":"187","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"188"},{"filePath":"189","messages":"190","suppressedMessages":"191","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"192","messages":"193","suppressedMessages":"194","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"195"},{"filePath":"196","messages":"197","suppressedMessages":"198","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"199"},{"filePath":"200","messages":"201","suppressedMessages":"202","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"203","messages":"204","suppressedMessages":"205","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"206","messages":"207","suppressedMessages":"208","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"209","messages":"210","suppressedMessages":"211","errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"212"},"E:\\coding_journey\\headless-cms\\packages\\server\\jest.config.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\errorModel.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\schema.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\common\\types.d.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\env\\schema.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\env\\server.ts",["213"],[],"// @ts-check\nimport { config } from \"dotenv\";\n\nconfig();\n\nimport { serverSchema } from \"./schema\";\nimport logger from \"../utils/logger\";\nconst _serverEnv = serverSchema.safeParse(process.env);\n\nif (!_serverEnv.success) {\n  logger([\"❌ Invalid environment variables:\\n\", _serverEnv.error]);\n  const {\n    error: { issues },\n  } = _serverEnv;\n  issues.forEach((issue) => {\n    throw new Error(`Invalid environment variables ${issue.message}`);\n  });\n}\n\nconst _ = _serverEnv.success;\n\nconst temp = { _serverEnv };\n\nexport const env = temp._serverEnv.success\n  ? temp._serverEnv.data\n  : serverSchema.parse({});\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\middlewares\\errorHandler.ts",["214"],[],"import { ErrorRequestHandler, NextFunction, Request, Response } from \"express\";\nimport logger from \"../utils/logger\";\nimport { CustomError } from \"../common/errorModel\";\nimport { ZodError } from \"zod\";\n\n/**\n * Custom error handler to standardize error objects returned to\n * the client\n *\n * @param err Error caught by Express.js\n * @param req Request object provided by Express\n * @param res Response object provided by Express\n * @param next NextFunction function provided by Express\n */\n\nconst handleError = (\n  err: ErrorRequestHandler,\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  logger([err, \"errorHandler\"]);\n\n  if (err instanceof CustomError) {\n    return res.status(err.status).json({ message: err.message });\n  }\n  if (err instanceof ZodError) {\n    return res.status(400).json({ message: err.message });\n  }\n\n  logger([\"error\", err]);\n  return res.status(500).json({ Message: \"Internal server error\" });\n};\n\nexport default handleError;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\middlewares\\isAuth.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\preinit.ts",["215"],[],"import { NextFunction, Request, Response } from \"express\";\n\nexport const init = (res: Response, req: Request, next: NextFunction) => {\n  req.pre = {} as any;\n  next();\n};\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\auth.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\schema.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\auth\\utils.ts",["216","217","218","219","220","221"],[],"import jwt, { decode, JwtPayload } from \"jsonwebtoken\";\nimport { env } from \"../../env/server\";\nimport { Request, Response, NextFunction } from \"express\";\nimport logger from \"../../utils/logger\";\n\nexport enum jwtType {\n  ACCESS = \"access\",\n  REFRESH = \"refresh\",\n}\n\nconst signToken = (\n  type: jwtType,\n  payload: Record<string, any>,\n  expiresIn: number\n): Promise<string> => {\n  const secret =\n    type === jwtType.ACCESS\n      ? env.JWT_ACCESS_TOKEN_SECRET\n      : env.JWT_REFRESH_TOKEN_SECRET;\n  return new Promise((resolve, reject) => {\n    jwt.sign(payload, secret, { expiresIn }, (err, token) => {\n      if (err) {\n        logger([\"error\", err]);\n        return reject(\n          new Error(\"Error while signing token. Please try again later.\")\n        );\n      }\n\n      return resolve(token as string);\n    });\n  });\n};\n\nconst verifyToken = (type: jwtType, token: string) => {\n  const secret =\n    type === jwtType.ACCESS\n      ? env.JWT_ACCESS_TOKEN_SECRET\n      : env.JWT_REFRESH_TOKEN_SECRET;\n  let user: JwtPayload | boolean | string | undefined;\n\n  // @ts-ignore\n  jwt.verify(token, secret, (err, decoded) => {\n    if (err) {\n      logger([\"error\", err]);\n      user = false;\n    }\n    user = decoded;\n  });\n  return user;\n};\n\nexport { signToken, verifyToken };\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\content.schema.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\content.ts",["222","223","224","225","226","227","228","229","230"],[],"import { NextFunction, Router } from \"express\";\nimport { zMiddleware, zParse } from \"../../utils/zParse\";\nimport { createContentSchema } from \"./content.schema\";\nimport { prisma } from \"../../utils/prisma\";\nimport isAuth from \"../../middlewares/isAuth\";\nimport { jwtType } from \"../auth/utils\";\nimport { commonIdParamSchema, commonUserSchema } from \"../../common/schema\";\nimport { preResource, Resource } from \"../../utils/pre/preMiddleware\";\n\nconst content = Router();\n\ncontent.get(\n  \"/\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema),\n  preResource([Resource.User, Resource.ContentModel]),\n  async (req, res, next: NextFunction) => {\n    const { model } = req.pre;\n    const { id } = model;\n    const content = await prisma.content.findMany({\n      where: { contentModelId: id },\n    });\n\n    return res.status(200).json({ content });\n  }\n);\n\ncontent.get(\n  \"/:id\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema.merge(commonIdParamSchema)),\n  preResource([Resource.ContentModel]),\n  async (req, res, next: NextFunction) => {\n    const {\n      params: { id },\n    } = await zParse(commonIdParamSchema, req);\n    const { model } = req.pre;\n    const content = await prisma.content.findMany({\n      where: { id, contentModelId: model!.id },\n    });\n\n    return res.status(200).json({ content });\n  }\n);\n\ncontent.post(\n  \"/\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(createContentSchema),\n  preResource([Resource.ContentModel]),\n  async (req, res, next) => {\n    const {\n      user,\n      body,\n      body: { contentModelId },\n    } = await zParse(createContentSchema, req);\n    const { model } = req.pre;\n\n    const isDuplicate = await prisma.content.findFirst({\n      where: { ...body, contentModelId: model.id },\n    });\n\n    if (isDuplicate)\n      return res.status(409).json({ message: \"Content already exists\" });\n\n    const content = await prisma.content.create({\n      data: { ...body } as any,\n    });\n\n    return res.status(201).json({ content });\n  }\n);\n\ncontent.delete(\n  \"/:id\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema.merge(commonIdParamSchema)),\n  preResource([Resource.Content]),\n  async (req, res, next: NextFunction) => {\n    const { content } = req.pre;\n    const { id, contentModelId } = content;\n\n    await prisma.content.delete({\n      where: { id, contentModelId } as any,\n    });\n\n    return res.status(204).send();\n  }\n);\n\nexport default content;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\content\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\contentModel.schema.ts",["231"],[],"import { z } from \"zod\";\nimport { commonUserSchema, reqBoolean } from \"../../common/schema\";\nimport { stringify } from \"ts-jest\";\n\nconst contentModelSchema = z\n  .object({\n    body: z.object({\n      text: reqBoolean,\n      number: reqBoolean,\n      json: reqBoolean,\n    }),\n  })\n  .merge(commonUserSchema);\n\nexport { contentModelSchema };\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\contentModel.ts",["232","233","234","235"],[],"import { Router } from \"express\";\nimport isAuth from \"../../middlewares/isAuth\";\nimport { jwtType } from \"../auth/utils\";\nimport { zMiddleware, zParse } from \"../../utils/zParse\";\nimport { commonIdParamSchema, commonUserSchema } from \"../../common/schema\";\nimport { contentModelSchema } from \"./contentModel.schema\";\nimport { prisma } from \"../../utils/prisma\";\nimport { preResource, Resource } from \"../../utils/pre/preMiddleware\";\n\nconst contentModel = Router();\n\ncontentModel.get(\n  \"/\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema),\n  async (req, res, next) => {\n    const {\n      user: { id },\n    } = await zParse(commonUserSchema, req);\n\n    const contentModel = await prisma.contentModel.findMany({\n      where: { userId: id },\n    });\n\n    if (contentModel.length === 0)\n      return res\n        .status(404)\n        .json({ message: \"You don't have content models !\" });\n\n    return res.json({ contentModel: contentModel });\n  }\n);\n\ncontentModel.get(\n  \"/:id\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonIdParamSchema.merge(commonUserSchema)),\n  preResource([Resource.User, Resource.ContentModel]),\n  async (req, res, next) => {\n    const { model } = req.pre;\n    return res.json({ contentModel: model });\n  }\n);\n\ncontentModel.post(\n  \"/\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(contentModelSchema),\n  preResource([Resource.User]),\n  async (req, res, next) => {\n    const { body } = await zParse(contentModelSchema, req);\n    const { id } = req.pre.user;\n\n    const contentModel = await prisma.contentModel.create({\n      data: { ...body, userId: id },\n    });\n\n    return res.status(201).json({ contentModel });\n  }\n);\n\ncontentModel.delete(\n  \"/:id\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonIdParamSchema.merge(commonUserSchema)),\n  preResource([Resource.User, Resource.ContentModel]),\n  async (req, res, next) => {\n    const { model } = req.pre;\n    await prisma.contentModel.delete({ where: { id: model.id } });\n\n    return res.status(204).send();\n  }\n);\n\nexport default contentModel;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\contentModel\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\health\\health.ts",["236","237"],[],"import { Router } from \"express\";\nimport isAuth from \"../../middlewares/isAuth\";\nimport { jwtType } from \"../auth/utils\";\n\nconst health = Router();\nhealth.get(\"/\", (req, res) => {\n  return res.json({ message: \"ok\" });\n});\n\nexport default health;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\health\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\index.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\schema.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\routes\\user\\user.ts",["238","239","240","241"],[],"import { Router } from \"express\";\nimport { userSchema } from \"./schema\";\nimport { zMiddleware, zParse } from \"../../utils/zParse\";\nimport isAuth from \"../../middlewares/isAuth\";\nimport { jwtType, signToken } from \"../auth/utils\";\nimport { commonUserSchema } from \"../../common/schema\";\nimport { prisma } from \"../../utils/prisma\";\nimport { env } from \"../../env/server\";\nimport { preResource, Resource } from \"../../utils/pre/preMiddleware\";\n\nconst user = Router();\n\nuser.get(\n  \"/me\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema),\n  preResource([Resource.User]),\n  async (req, res, next) => {\n    const { user } = req.pre;\n    return res.status(200).json(user);\n  }\n);\n\nuser.post(\"/\", zMiddleware(userSchema), async (req, res, next) => {\n  const {\n    body: { username, password },\n  } = await zParse(userSchema, req);\n  const isUserExist = await prisma.user.findFirst({\n    where: { username },\n  });\n  if (isUserExist)\n    return res.status(409).json({ message: \"User already exist\" });\n\n  const user = await prisma.user.create({ data: { username, password } });\n  const accessToken = await signToken(\n    jwtType.ACCESS,\n    { id: user.id, username },\n    parseInt(env.JWT_ACCESS_TOKEN_EXPIRES_IN)\n  );\n\n  const refreshToken = await signToken(\n    jwtType.REFRESH,\n    { id: user.id, username },\n    parseInt(env.JWT_REFRESH_TOKEN_EXPIRES_IN)\n  );\n  const { password: _, ...userObj } = user;\n  return res.status(201).json({ user: userObj, accessToken, refreshToken });\n});\n\nuser.delete(\n  \"/me\",\n  isAuth(jwtType.ACCESS),\n  zMiddleware(commonUserSchema),\n  preResource([Resource.User]),\n  async (req, res, next) => {\n    const { user } = req.pre;\n    const { id } = user;\n    await prisma.user.delete({ where: { id } });\n    return res.status(204).send();\n  }\n);\n\nexport default user;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\types\\express\\index.d.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\logger.ts",[],["242"],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\content.ts",["243"],[],"import { prisma } from \"../prisma\";\nimport { Request } from \"express\";\nimport contentModel from \"./contentModel\";\nimport { CustomError } from \"../../common/errorModel\";\n\nexport const preContent = async (req: Request): Promise<void> => {\n  await contentModel(req);\n  const { model } = req.pre;\n  const content = await prisma.content.findFirst({\n    where: { contentModelId: model.id },\n  });\n  //@ts-ignore\n  if (!content) return CustomError.notFound(\"You don't have content !\");\n\n  req.pre.content = content;\n};\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\contentModel.ts",["244"],[],"import { prisma } from \"../prisma\";\nimport { Request } from \"express\";\nimport { zParse } from \"../zParse\";\nimport { commonUserSchema } from \"../../common/schema\";\nimport { CustomError } from \"../../common/errorModel\";\n\nconst contentModel = async (req: Request): Promise<void> => {\n  const {\n    user: { id },\n  } = await zParse(commonUserSchema, req);\n\n  const model = await prisma.contentModel.findFirst({\n    where: { userId: id },\n  });\n\n  //@ts-ignore\n  if (!model) return CustomError.notFound(\"You don't have content models !\");\n  req.pre.model = model;\n};\n\nexport default contentModel;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\preMiddleware.ts",["245"],[],"import { NextFunction, Request, Response } from \"express\";\nimport userMe from \"./user\";\nimport contentModel from \"./contentModel\";\nimport { CustomError } from \"../../common/errorModel\";\nimport { preContent } from \"./content\";\n\nexport enum Resource {\n  User = \"user\",\n  ContentModel = \"contentModel\",\n  Content = \"content\",\n}\n\n/**\n * Checks if resource is throwing error*/\nexport const preResource = (resources: Resource[]) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    let resourceResult: any;\n    for (const resource of resources) {\n      switch (resource) {\n        case Resource.User:\n          resourceResult = await userMe(req);\n          if (resourceResult instanceof CustomError) next(resourceResult);\n          break;\n        case Resource.ContentModel:\n          resourceResult = await contentModel(req);\n          if (resourceResult instanceof CustomError) next(resourceResult);\n          break;\n        case Resource.Content:\n          resourceResult = await preContent(req);\n      }\n    }\n    next();\n  };\n};\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\pre\\user.ts",["246","247"],[],"import { zParse } from \"../zParse\";\nimport { commonUserSchema } from \"../../common/schema\";\nimport { prisma } from \"../prisma\";\nimport { Request } from \"express\";\nimport { CustomError } from \"../../common/errorModel\";\n\nconst userMe = async (req: Request): Promise<void> => {\n  const {\n    user: { id },\n  } = await zParse(commonUserSchema, req);\n\n  const user = await prisma.user.findFirst({ where: { id } });\n  // @ts-ignore\n  if (!user) return CustomError.notFound(\"User doesn't exist\");\n\n  const { password, ...userObj } = user;\n  req.pre.user = userObj;\n  return;\n};\n\nexport default userMe;\n","E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\prisma.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\src\\utils\\zParse.ts",["248"],[],"import type { NextFunction, Request, Response } from \"express\";\nimport { AnyZodObject, z } from \"zod\";\nimport { CustomError } from \"../common/errorModel\";\nimport logger from \"./logger\";\n\nconst zParse = async <T extends AnyZodObject>(\n  schema: T,\n  req: Request\n): Promise<z.infer<T>> => {\n  const zSchema = await schema.safeParseAsync(req);\n  if (!zSchema.success)\n    return CustomError.badRequest(zSchema.error.message) as any;\n  return zSchema.data;\n};\n\n// zod middleware to validate schema before parsing\nconst zMiddleware = <T extends AnyZodObject>(schema: T) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    const zSchema = await schema.safeParseAsync(req);\n    if (!zSchema.success) {\n      const {\n        error: { issues },\n      } = zSchema;\n      logger([\"zMiddleware\", \"error\", issues]);\n      issues.forEach((issue) => {\n        logger([\"zMiddleware\", issue.message]);\n        next(\n          CustomError.badRequest(`${issue.message} ${issue.path.join(\".\")}`)\n        );\n      });\n    }\n    next();\n  };\n};\n\nexport { zParse, zMiddleware };\n","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\auth\\auth.test.ts",["249"],[],"import { makeTestRequest } from \"../utils\";\n\nlet user;\nlet tokens: { accessToken: string; refreshToken: string };\nconst testUser = {\n  username: \"test\",\n  password: \"test\",\n};\nconst zodTestCases = [\n  {\n    body: {\n      username: 1,\n      password: \"string\",\n      grant_type: \"password\",\n    },\n    expect: \"Expected string, received number body.username\",\n  },\n  {\n    body: {\n      username: \"string\",\n      password: 1,\n      grant_type: \"password\",\n    },\n    expect: \"Expected string, received number body.password\",\n  },\n  {\n    body: {\n      ...testUser,\n      grant_type: 1,\n    },\n    expect:\n      \"Expected 'password' | 'refresh_token', received number body.grant_type\",\n  },\n  {\n    body: {\n      refreshToken: 1,\n      grant_type: \"refresh_token\",\n    },\n    expect: \"Expected string, received number body.refreshToken\",\n  },\n  {\n    body: { refreshToken: \"dawdaw\", grant_type: 1 },\n    expect:\n      \"Expected 'password' | 'refresh_token', received number body.grant_type\",\n  },\n];\n\nbeforeAll(async () => {\n  const token = await makeTestRequest(\"post\", \"/user\", testUser);\n  const { user: User } = token.body;\n  user = User;\n\n  tokens = {\n    accessToken: token.body.accessToken,\n    refreshToken: token.body.refreshToken,\n  };\n});\nafterAll(async () => {\n  const { accessToken } = tokens;\n  await makeTestRequest(\"delete\", \"/user/me\", undefined, accessToken);\n});\n\ndescribe(\"/auth\", () => {\n  describe(\"POST\", () => {\n    describe(\"/\", () => {\n      it(\"should return AccessToken and RefreshToken(201) grant_type=password\", async () => {\n        const expectedProperties = [\"accessToken\", \"refreshToken\"];\n        const res = await makeTestRequest(\"post\", \"/auth\", {\n          ...testUser,\n          grant_type: \"password\",\n        });\n        expectedProperties.forEach((property) => {\n          expect(res.body).toHaveProperty(property);\n          expect(typeof res.body[property]).toBe(\"string\");\n          expect(res.body[property].length > 0).toBe(true);\n        });\n        expect(res.status).toBe(201);\n      });\n      // todo -fix\n      it(\"should return AccessToken and RefreshToken(201) grant_type=refresh_token\", async () => {\n        const expectedProperties = [\"accessToken\", \"refreshToken\"];\n        const { refreshToken } = tokens;\n        const res = await makeTestRequest(\"post\", \"/auth\", {\n          grant_type: \"refresh_token\",\n          refreshToken,\n        });\n\n        expectedProperties.forEach((property) => {\n          expect(res.body).toHaveProperty(property);\n          expect(typeof res.body[property]).toBe(\"string\");\n          expect(res.body[property].length > 0).toBe(true);\n        });\n        expect(res.status).toBe(201);\n      });\n      for (const testCase of zodTestCases) {\n        const { body, expect: message } = testCase;\n        it(`testing zod schema with body: ${JSON.stringify(\n          body,\n          undefined\n        )}`, async () => {\n          const res = await makeTestRequest(\"post\", \"/auth\", body);\n          expect(res.body.message).toBe(message);\n          expect(res.status).toBe(400);\n        });\n      }\n      it(\"should return Not Found(404) grant_type=password\", async () => {\n        const res = await makeTestRequest(\"post\", \"/auth\", {\n          username: \"nonExistent\",\n          password: \"nonExistent\",\n          grant_type: \"password\",\n        });\n        expect(res.body.message).toBe(\"User doesn't exist\");\n        expect(res.status).toBe(404);\n      });\n\n      it(\"should return Not Found(404) grant_type=refresh_token\", async () => {\n        const res = await makeTestRequest(\"post\", \"/auth\", {\n          refreshToken: \"invalidToken\",\n          grant_type: \"refresh_token\",\n        });\n        expect(res.body.message).toBe(\"Invalid refresh token\");\n        expect(res.status).toBe(401);\n      });\n    });\n  });\n});\n","E:\\coding_journey\\headless-cms\\packages\\server\\tests\\contentModel\\contentModel.test.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\tests\\jest.setup.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\tests\\user\\user.test.ts",[],[],"E:\\coding_journey\\headless-cms\\packages\\server\\tests\\utils.ts",["250","251","252"],[],"import app from \"../src/index\";\nimport request from \"supertest\";\nimport logger from \"../src/utils/logger\";\n\nconst instance = request(app);\n\nexport const makeTestRequest = (\n  method: string,\n  url: string,\n  data?: any,\n  jwtToken?: string\n): Promise<any> => {\n  if (jwtToken)\n    return instance[method](url)\n      .set({\n        Authorization: `Bearer ${jwtToken}`,\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      })\n      .send(data);\n  return instance[method](url)\n    .set(\"Content-Type\", \"application/json\")\n    .send(data);\n};\n",{"ruleId":"253","severity":1,"message":"254","line":20,"column":7,"nodeType":"255","messageId":"256","endLine":20,"endColumn":8},{"ruleId":"253","severity":1,"message":"257","line":20,"column":3,"nodeType":"255","messageId":"256","endLine":20,"endColumn":21},{"ruleId":"258","severity":1,"message":"259","line":4,"column":19,"nodeType":"260","messageId":"261","endLine":4,"endColumn":22,"suggestions":"262"},{"ruleId":"253","severity":1,"message":"263","line":1,"column":15,"nodeType":"255","messageId":"256","endLine":1,"endColumn":21},{"ruleId":"253","severity":1,"message":"264","line":3,"column":10,"nodeType":"255","messageId":"256","endLine":3,"endColumn":17},{"ruleId":"253","severity":1,"message":"265","line":3,"column":19,"nodeType":"255","messageId":"256","endLine":3,"endColumn":27},{"ruleId":"253","severity":1,"message":"266","line":3,"column":29,"nodeType":"255","messageId":"256","endLine":3,"endColumn":41},{"ruleId":"258","severity":1,"message":"259","line":13,"column":27,"nodeType":"260","messageId":"261","endLine":13,"endColumn":30,"suggestions":"267"},{"ruleId":"268","severity":1,"message":"269","line":41,"column":3,"nodeType":"270","messageId":"271","endLine":41,"endColumn":16},{"ruleId":"253","severity":1,"message":"257","line":17,"column":20,"nodeType":"255","messageId":"256","endLine":17,"endColumn":38},{"ruleId":"253","severity":1,"message":"257","line":33,"column":20,"nodeType":"255","messageId":"256","endLine":33,"endColumn":38},{"ruleId":"272","severity":1,"message":"273","line":39,"column":36,"nodeType":"274","messageId":"275","endLine":39,"endColumn":42,"suggestions":"276"},{"ruleId":"253","severity":1,"message":"257","line":51,"column":20,"nodeType":"255","messageId":"256","endLine":51,"endColumn":24},{"ruleId":"253","severity":1,"message":"277","line":53,"column":7,"nodeType":"255","messageId":"256","endLine":53,"endColumn":11},{"ruleId":"253","severity":1,"message":"278","line":55,"column":15,"nodeType":"255","messageId":"256","endLine":55,"endColumn":29},{"ruleId":"258","severity":1,"message":"259","line":67,"column":28,"nodeType":"260","messageId":"261","endLine":67,"endColumn":31,"suggestions":"279"},{"ruleId":"253","severity":1,"message":"257","line":79,"column":20,"nodeType":"255","messageId":"256","endLine":79,"endColumn":38},{"ruleId":"258","severity":1,"message":"259","line":84,"column":40,"nodeType":"260","messageId":"261","endLine":84,"endColumn":43,"suggestions":"280"},{"ruleId":"253","severity":1,"message":"281","line":3,"column":10,"nodeType":"255","messageId":"256","endLine":3,"endColumn":19},{"ruleId":"253","severity":1,"message":"257","line":16,"column":20,"nodeType":"255","messageId":"256","endLine":16,"endColumn":24},{"ruleId":"253","severity":1,"message":"257","line":39,"column":20,"nodeType":"255","messageId":"256","endLine":39,"endColumn":24},{"ruleId":"253","severity":1,"message":"257","line":50,"column":20,"nodeType":"255","messageId":"256","endLine":50,"endColumn":24},{"ruleId":"253","severity":1,"message":"257","line":67,"column":20,"nodeType":"255","messageId":"256","endLine":67,"endColumn":24},{"ruleId":"253","severity":1,"message":"282","line":2,"column":8,"nodeType":"255","messageId":"256","endLine":2,"endColumn":14},{"ruleId":"253","severity":1,"message":"283","line":3,"column":10,"nodeType":"255","messageId":"256","endLine":3,"endColumn":17},{"ruleId":"253","severity":1,"message":"257","line":18,"column":20,"nodeType":"255","messageId":"256","endLine":18,"endColumn":24},{"ruleId":"253","severity":1,"message":"257","line":24,"column":58,"nodeType":"255","messageId":"256","endLine":24,"endColumn":62},{"ruleId":"253","severity":1,"message":"254","line":46,"column":21,"nodeType":"255","messageId":"256","endLine":46,"endColumn":22},{"ruleId":"253","severity":1,"message":"257","line":55,"column":20,"nodeType":"255","messageId":"256","endLine":55,"endColumn":24},{"ruleId":"284","severity":2,"message":"285","line":5,"column":3,"nodeType":"286","messageId":"287","endLine":5,"endColumn":14,"suppressions":"288"},{"ruleId":"268","severity":1,"message":"269","line":12,"column":3,"nodeType":"270","messageId":"271","endLine":12,"endColumn":15},{"ruleId":"268","severity":1,"message":"269","line":16,"column":3,"nodeType":"270","messageId":"271","endLine":16,"endColumn":15},{"ruleId":"258","severity":1,"message":"259","line":17,"column":25,"nodeType":"260","messageId":"261","endLine":17,"endColumn":28,"suggestions":"289"},{"ruleId":"268","severity":1,"message":"269","line":13,"column":3,"nodeType":"270","messageId":"271","endLine":13,"endColumn":16},{"ruleId":"253","severity":1,"message":"290","line":16,"column":11,"nodeType":"255","messageId":"256","endLine":16,"endColumn":19},{"ruleId":"258","severity":1,"message":"259","line":12,"column":61,"nodeType":"260","messageId":"261","endLine":12,"endColumn":64,"suggestions":"291"},{"ruleId":"253","severity":1,"message":"277","line":3,"column":5,"nodeType":"255","messageId":"256","endLine":3,"endColumn":9},{"ruleId":"253","severity":1,"message":"292","line":3,"column":8,"nodeType":"255","messageId":"256","endLine":3,"endColumn":14},{"ruleId":"258","severity":1,"message":"259","line":10,"column":10,"nodeType":"260","messageId":"261","endLine":10,"endColumn":13,"suggestions":"293"},{"ruleId":"258","severity":1,"message":"259","line":12,"column":12,"nodeType":"260","messageId":"261","endLine":12,"endColumn":15,"suggestions":"294"},"@typescript-eslint/no-unused-vars","'_' is assigned a value but never used.","Identifier","unusedVar","'next' is defined but never used.","@typescript-eslint/no-explicit-any","Unexpected any. Specify a different type.","TSAnyKeyword","unexpectedAny",["295","296"],"'decode' is defined but never used.","'Request' is defined but never used.","'Response' is defined but never used.","'NextFunction' is defined but never used.",["297","298"],"@typescript-eslint/ban-ts-comment","Do not use \"@ts-ignore\" because it alters compilation errors.","Line","tsDirectiveComment","@typescript-eslint/no-non-null-assertion","Forbidden non-null assertion.","TSNonNullExpression","noNonNull",["299"],"'user' is assigned a value but never used.","'contentModelId' is assigned a value but never used.",["300","301"],["302","303"],"'stringify' is defined but never used.","'isAuth' is defined but never used.","'jwtType' is defined but never used.","no-console","Unexpected console statement.","MemberExpression","unexpected",["304","305"],["306","307"],"'password' is assigned a value but never used.",["308","309"],"'logger' is defined but never used.",["310","311"],["312","313"],{"messageId":"314","fix":"315","desc":"316"},{"messageId":"317","fix":"318","desc":"319"},{"messageId":"314","fix":"320","desc":"316"},{"messageId":"317","fix":"321","desc":"319"},{"messageId":"322","fix":"323","desc":"324"},{"messageId":"314","fix":"325","desc":"316"},{"messageId":"317","fix":"326","desc":"319"},{"messageId":"314","fix":"327","desc":"316"},{"messageId":"317","fix":"328","desc":"319"},{"kind":"329","justification":"330"},{"kind":"329","justification":"330"},{"messageId":"314","fix":"331","desc":"316"},{"messageId":"317","fix":"332","desc":"319"},{"messageId":"314","fix":"333","desc":"316"},{"messageId":"317","fix":"334","desc":"319"},{"messageId":"314","fix":"335","desc":"316"},{"messageId":"317","fix":"336","desc":"319"},{"messageId":"314","fix":"337","desc":"316"},{"messageId":"317","fix":"338","desc":"319"},"suggestUnknown",{"range":"339","text":"340"},"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct.","suggestNever",{"range":"339","text":"341"},"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of.",{"range":"342","text":"340"},{"range":"342","text":"341"},"suggestOptionalChain",{"range":"343","text":"344"},"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator.",{"range":"345","text":"340"},{"range":"345","text":"341"},{"range":"346","text":"340"},{"range":"346","text":"341"},"directive","",{"range":"347","text":"340"},{"range":"347","text":"341"},{"range":"348","text":"340"},{"range":"348","text":"341"},{"range":"349","text":"340"},{"range":"349","text":"341"},{"range":"350","text":"340"},{"range":"350","text":"341"},[153,156],"unknown","never",[329,332],[1256,1257],"?",[1919,1922],[2329,2332],[522,525],[426,429],[215,218],[251,254]]